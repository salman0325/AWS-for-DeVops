

## Pre-Requisites

- 2 EC2 Instances (same region)
- Security groups allowing HTTP (port 80) and/or HTTPS (port 443)
- EC2 instances should have a web server installed (e.g., Apache, Nginx)

---

## Classic Load Balancer (CLB)

### Step-by-Step

1. Go to **EC2 > Load Balancers > Create Load Balancer**
2. Select **Classic Load Balancer**
3. Enter a name (e.g., `my-classic-lb`)
4. Select **VPC** and **Availability Zones**
5. Listener: HTTP (80) or HTTPS (443)
6. Assign Security Group
7. Health Check:
   - Protocol: HTTP
   - Ping Path: `/` or custom path
8. Add EC2 instances
9. Review and **Create**

---

## Application Load Balancer (ALB)

### Step-by-Step

1. Go to **EC2 > Load Balancers > Create Load Balancer**
2. Select **Application Load Balancer**
3. Set name (e.g., `my-alb`)
4. Scheme: internet-facing or internal
5. Select at least 2 AZs
6. Configure listeners (HTTP or HTTPS)
7. Assign a Security Group
8. Create or choose a Target Group (use IP or instance ID)
9. Register both EC2 instances to the target group
10. Review and **Create**

---

### Path-Based Routing

1. Go to **ALB > Listeners > View/Edit Rules**
2. Add rule:
   - Condition: `Path is /app1/*`
   - Action: Forward to target group `App1TG`
3. Add another rule for `/app2/*` to forward to `App2TG`

**Example:**
```

/app1/* -> App1TG
/app2/* -> App2TG

````

---

### Sticky Sessions (Stickiness)

1. Go to **Target Group > Attributes**
2. Enable **Stickiness**
3. Type: `lb_cookie`
4. Duration: e.g., 300 seconds

---

### Custom Error Page Routing

1. Go to **Listeners > Rules**
2. Edit default action or add rule for HTTP code `404`, `500`, etc.
3. Redirect to a custom page using:
   - Action: Redirect or Fixed response
   - Custom status code (e.g., `404`)
   - Body: HTML error message or redirect URL

---

### Getting Client IP Address on ALB

Use the `X-Forwarded-For` header to get the real client IP in your application.

#### Example in Apache:
```apache
LogFormat "%{X-Forwarded-For}i %h %l %u %t \"%r\" %>s %b" combined
````

#### Example in Nginx:

```nginx
log_format custom '$http_x_forwarded_for - $remote_user [$time_local] '
                  '"$request" $status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent"';
```

---

## Network Load Balancer (NLB)

### Step-by-Step

1. Go to **EC2 > Load Balancers > Create Load Balancer**
2. Select **Network Load Balancer**
3. Set name (e.g., `my-nlb`)
4. Scheme: internet-facing
5. Listener: TCP (e.g., port 80 or 443)
6. Select AZs and subnets
7. Create Target Group:

   * Target Type: Instance
   * Protocol: TCP
   * Register your EC2 instances
8. Review and **Create**

---

## Test Setup

* Deploy a simple web page on both EC2 instances with different messages (e.g., "Instance 1", "Instance 2")
* Use curl or browser to test routing:

```bash
curl http://<ALB-DNS>/app1/
curl http://<ALB-DNS>/app2/
```

---

## Notes

* CLB is legacy; use ALB or NLB for new applications
* ALB is best for HTTP(S) applications needing path-based routing
* NLB is best for high performance, TCP/UDP traffic

```


